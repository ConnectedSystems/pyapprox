

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyapprox.multivariate_polynomials &mdash; PyApprox 1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/gallery-dataframe.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
        <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"V": ["{\\boldsymbol{#1}}", 1], "mean": ["{\\mathbb{E}\\left[#1\\right]}", 1], "var": ["{\\mathbb{V}\\left[#1\\right]}", 1], "argmin": "{\\mathrm{argmin}}", "rv": "z", "reals": "\\mathbb{R}", "pdf": "\\rho", "rvdom": "\\Gamma", "coloneqq": "\\colon=", "norm": ["{\\lVert #1 \\rVert}", 1], "argmax": ["\\operatorname{argmax}"], "covar": ["\\mathbb{C}\\text{ov}\\left[#1,#2\\right]", 2], "corr": ["\\mathbb{C}\\text{or}\\left[#1,#2\\right]", 2], "ai": "\\alpha", "bi": "\\beta", "dx": ["\\;\\mathrm{d}#1", 1]}}})</script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> PyApprox
          

          
            
            <img src="../../_static/pyapprox-logo.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../auto_tutorials/index.html">PyApprox Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">Benchmarks</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../benchmarks.html">Benchmarks</a></li>
</ul>
<p class="caption"><span class="caption-text">User Reference Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../user_reference_guide.html">User Reference Guide</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Reference Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Developer Reference Guide</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">PyApprox</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>pyapprox.multivariate_polynomials</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyapprox.multivariate_polynomials</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyapprox.indexing</span> <span class="kn">import</span> \
     <span class="n">compute_hyperbolic_indices</span>
<span class="kn">from</span> <span class="nn">pyapprox.utilities</span> <span class="kn">import</span> <span class="n">cartesian_product</span><span class="p">,</span> <span class="n">outer_product</span>
<span class="kn">from</span> <span class="nn">pyapprox.orthonormal_polynomials_1d</span> <span class="kn">import</span> \
     <span class="n">jacobi_recurrence</span><span class="p">,</span> <span class="n">evaluate_orthonormal_polynomial_deriv_1d</span><span class="p">,</span> \
     <span class="n">hermite_recurrence</span><span class="p">,</span> <span class="n">krawtchouk_recurrence</span><span class="p">,</span> <span class="n">hahn_recurrence</span><span class="p">,</span> \
     <span class="n">discrete_chebyshev_recurrence</span><span class="p">,</span> <span class="n">evaluate_orthonormal_polynomial_1d</span>
<span class="kn">from</span> <span class="nn">pyapprox.monomial</span> <span class="kn">import</span> <span class="n">monomial_basis_matrix</span>
<span class="kn">from</span> <span class="nn">pyapprox.numerically_generate_orthonormal_polynomials_1d</span> <span class="kn">import</span> <span class="n">lanczos</span><span class="p">,</span> \
    <span class="n">modified_chebyshev_orthonormal</span>
<span class="kn">from</span> <span class="nn">pyapprox.utilities</span> <span class="kn">import</span> \
    <span class="n">flattened_rectangular_lower_triangular_matrix_index</span>
<span class="kn">from</span> <span class="nn">pyapprox.probability_measure_sampling</span> <span class="kn">import</span> \
    <span class="n">generate_independent_random_samples</span>
<span class="kn">from</span> <span class="nn">pyapprox.manipulate_polynomials</span> <span class="kn">import</span> <span class="n">add_polynomials</span>

<div class="viewcode-block" id="precompute_multivariate_orthonormal_polynomial_univariate_values"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.precompute_multivariate_orthonormal_polynomial_univariate_values.html#pyapprox.multivariate_polynomials.precompute_multivariate_orthonormal_polynomial_univariate_values">[docs]</a><span class="k">def</span> <span class="nf">precompute_multivariate_orthonormal_polynomial_univariate_values</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span><span class="n">indices</span><span class="p">,</span><span class="n">recursion_coeffs</span><span class="p">,</span><span class="n">deriv_order</span><span class="p">,</span><span class="n">basis_type_index_map</span><span class="p">):</span>
    <span class="n">num_vars</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_level_1d</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">basis_type_index_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">basis_type_index_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_vars</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">recursion_coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">recursion_coeffs</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">recursion_coeffs</span><span class="p">[</span><span class="n">basis_type_index_map</span><span class="p">[</span><span class="n">dd</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span>
                <span class="n">max_level_1d</span><span class="p">[</span><span class="n">dd</span><span class="p">])</span>
    
    <span class="n">basis_vals_1d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span>
        <span class="p">(</span><span class="n">num_vars</span><span class="p">,(</span><span class="mi">1</span><span class="o">+</span><span class="n">deriv_order</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">max_level_1d</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1">#WARNING some entries of basis_vals_1d will remain uninitialized</span>
    <span class="c1">#when max_level_1d[dd]=max_level_1d.max() for directions dd</span>
    <span class="c1">#storing arrays of equal size allows fast vectorization based manipulation</span>
    <span class="c1">#in downstream functions</span>
    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">):</span>
        <span class="n">basis_vals_1d</span><span class="p">[</span><span class="n">dd</span><span class="p">,:(</span><span class="n">deriv_order</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">max_level_1d</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">),:]</span> <span class="o">=</span> \
            <span class="n">evaluate_orthonormal_polynomial_deriv_1d</span><span class="p">(</span>
                <span class="n">samples</span><span class="p">[</span><span class="n">dd</span><span class="p">,:],</span><span class="n">max_level_1d</span><span class="p">[</span><span class="n">dd</span><span class="p">],</span>
                <span class="n">recursion_coeffs</span><span class="p">[</span><span class="n">basis_type_index_map</span><span class="p">[</span><span class="n">dd</span><span class="p">]],</span><span class="n">deriv_order</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">basis_vals_1d</span></div>

<div class="viewcode-block" id="evaluate_multivariate_orthonormal_polynomial_values"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.evaluate_multivariate_orthonormal_polynomial_values.html#pyapprox.multivariate_polynomials.evaluate_multivariate_orthonormal_polynomial_values">[docs]</a><span class="k">def</span> <span class="nf">evaluate_multivariate_orthonormal_polynomial_values</span><span class="p">(</span>
        <span class="n">indices</span><span class="p">,</span><span class="n">basis_vals_1d</span><span class="p">,</span><span class="n">num_samples</span><span class="p">):</span>
    <span class="n">num_vars</span><span class="p">,</span><span class="n">num_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">temp1</span> <span class="o">=</span> <span class="n">basis_vals_1d</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_vars</span><span class="o">*</span><span class="n">basis_vals_1d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num_samples</span><span class="p">))</span>
    <span class="n">temp2</span> <span class="o">=</span> <span class="n">temp1</span><span class="p">[</span><span class="n">indices</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_vars</span><span class="p">)</span><span class="o">*</span><span class="n">basis_vals_1d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num_indices</span><span class="p">),:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_vars</span><span class="p">,</span><span class="n">num_indices</span><span class="p">,</span><span class="n">num_samples</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">temp2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="evaluate_multivariate_orthonormal_polynomial_derivs"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.evaluate_multivariate_orthonormal_polynomial_derivs.html#pyapprox.multivariate_polynomials.evaluate_multivariate_orthonormal_polynomial_derivs">[docs]</a><span class="k">def</span> <span class="nf">evaluate_multivariate_orthonormal_polynomial_derivs</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span><span class="n">max_level_1d</span><span class="p">,</span><span class="n">basis_vals_1d</span><span class="p">,</span><span class="n">num_samples</span><span class="p">,</span><span class="n">deriv_order</span><span class="p">):</span>
    <span class="c1"># TODO Consider combining</span>
    <span class="c1"># evaluate_multivariate_orthonormal_polynomial_values and derivs and</span>
    <span class="c1"># evaluate_multivariate_orthonormal_polynomial_derivs beecause they both</span>
    <span class="c1"># compute temp2</span>
    
    <span class="k">assert</span> <span class="n">deriv_order</span><span class="o">==</span><span class="mi">1</span>
    <span class="n">num_vars</span><span class="p">,</span><span class="n">num_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span>

    <span class="c1">#extract derivatives</span>
    <span class="n">temp1</span> <span class="o">=</span> <span class="n">basis_vals_1d</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">num_vars</span><span class="o">*</span><span class="n">basis_vals_1d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num_samples</span><span class="p">))</span>
    <span class="n">temp2</span> <span class="o">=</span> <span class="n">temp1</span><span class="p">[</span><span class="n">indices</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_vars</span><span class="p">)</span><span class="o">*</span><span class="n">basis_vals_1d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num_indices</span><span class="p">),:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_vars</span><span class="p">,</span><span class="n">num_indices</span><span class="p">,</span><span class="n">num_samples</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">temp2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="c1"># derivs are stored immeadiately after values in basis_vals_1d</span>
    <span class="c1"># if max_level_1d[dd]!=max_level_1d.max() then there will be some</span>
    <span class="c1"># uninitialized values at the end of the array but these are never accessed</span>
    <span class="n">temp3</span> <span class="o">=</span> <span class="n">temp1</span><span class="p">[</span><span class="n">indices</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">(</span><span class="n">max_level_1d</span><span class="o">+</span><span class="mi">1</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_vars</span><span class="p">)</span><span class="o">*</span><span class="n">basis_vals_1d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num_indices</span><span class="p">),:]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_vars</span><span class="p">,</span><span class="n">num_indices</span><span class="p">,</span><span class="n">num_samples</span><span class="p">)</span>

    <span class="n">derivs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_samples</span><span class="o">*</span><span class="n">num_vars</span><span class="p">,</span><span class="n">num_indices</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">):</span>
        <span class="n">derivs</span><span class="p">[(</span><span class="n">jj</span><span class="p">)</span><span class="o">*</span><span class="n">num_samples</span><span class="p">:(</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">num_samples</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">temp2</span><span class="p">[:</span><span class="n">jj</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">temp2</span><span class="p">[</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">*</span><span class="n">temp3</span><span class="p">[</span><span class="n">jj</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>

    <span class="k">return</span> <span class="n">derivs</span></div>

<div class="viewcode-block" id="precompute_multivariate_orthonormal_polynomial_univariate_values_deprecated"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.precompute_multivariate_orthonormal_polynomial_univariate_values_deprecated.html#pyapprox.multivariate_polynomials.precompute_multivariate_orthonormal_polynomial_univariate_values_deprecated">[docs]</a><span class="k">def</span> <span class="nf">precompute_multivariate_orthonormal_polynomial_univariate_values_deprecated</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span><span class="n">indices</span><span class="p">,</span><span class="n">recursion_coeffs</span><span class="p">,</span><span class="n">deriv_order</span><span class="p">,</span><span class="n">basis_type_index_map</span><span class="p">):</span>
    <span class="n">num_vars</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">max_level_1d</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">basis_type_index_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">basis_type_index_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_vars</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">recursion_coeffs</span> <span class="o">=</span> <span class="p">[</span><span class="n">recursion_coeffs</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">):</span>
        <span class="k">assert</span> <span class="p">(</span><span class="n">recursion_coeffs</span><span class="p">[</span><span class="n">basis_type_index_map</span><span class="p">[</span><span class="n">dd</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span>
                <span class="n">max_level_1d</span><span class="p">[</span><span class="n">dd</span><span class="p">])</span>
    
    <span class="n">basis_vals_1d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">):</span>
        <span class="n">basis_vals_1d_dd</span> <span class="o">=</span> <span class="n">evaluate_orthonormal_polynomial_deriv_1d</span><span class="p">(</span>
           <span class="n">samples</span><span class="p">[</span><span class="n">dd</span><span class="p">,:],</span><span class="n">max_level_1d</span><span class="p">[</span><span class="n">dd</span><span class="p">],</span>
           <span class="n">recursion_coeffs</span><span class="p">[</span><span class="n">basis_type_index_map</span><span class="p">[</span><span class="n">dd</span><span class="p">]],</span><span class="n">deriv_order</span><span class="p">)</span>
        <span class="n">basis_vals_1d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basis_vals_1d_dd</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">basis_vals_1d</span></div>

<div class="viewcode-block" id="evaluate_multivariate_orthonormal_polynomial_values_deprecated"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.evaluate_multivariate_orthonormal_polynomial_values_deprecated.html#pyapprox.multivariate_polynomials.evaluate_multivariate_orthonormal_polynomial_values_deprecated">[docs]</a><span class="k">def</span> <span class="nf">evaluate_multivariate_orthonormal_polynomial_values_deprecated</span><span class="p">(</span>
        <span class="n">indices</span><span class="p">,</span><span class="n">basis_vals_1d</span><span class="p">,</span><span class="n">num_samples</span><span class="p">):</span>
    <span class="n">num_vars</span><span class="p">,</span><span class="n">num_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">num_samples</span><span class="p">,</span><span class="n">num_indices</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_indices</span><span class="p">):</span>
       <span class="n">index</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span>
       <span class="n">values</span><span class="p">[:</span><span class="n">num_samples</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">basis_vals_1d</span><span class="p">[</span><span class="mi">0</span><span class="p">][:,</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
       <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">num_vars</span><span class="p">):</span>
           <span class="n">values</span><span class="p">[:</span><span class="n">num_samples</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span><span class="o">*=</span><span class="n">basis_vals_1d</span><span class="p">[</span><span class="n">dd</span><span class="p">][:,</span><span class="n">index</span><span class="p">[</span><span class="n">dd</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="evaluate_multivariate_orthonormal_polynomial_derivs_deprecated"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.evaluate_multivariate_orthonormal_polynomial_derivs_deprecated.html#pyapprox.multivariate_polynomials.evaluate_multivariate_orthonormal_polynomial_derivs_deprecated">[docs]</a><span class="k">def</span> <span class="nf">evaluate_multivariate_orthonormal_polynomial_derivs_deprecated</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span><span class="n">max_level_1d</span><span class="p">,</span><span class="n">basis_vals_1d</span><span class="p">,</span><span class="n">num_samples</span><span class="p">,</span><span class="n">deriv_order</span><span class="p">):</span>
    
    <span class="n">num_vars</span><span class="p">,</span><span class="n">num_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(((</span><span class="n">deriv_order</span><span class="o">*</span><span class="n">num_vars</span><span class="p">)</span><span class="o">*</span><span class="n">num_samples</span><span class="p">,</span><span class="n">num_indices</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_indices</span><span class="p">):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">):</span>
            <span class="c1"># derivative in jj direction</span>
            <span class="n">basis_vals</span><span class="o">=</span>\
                <span class="n">basis_vals_1d</span><span class="p">[</span><span class="n">jj</span><span class="p">][:,(</span><span class="n">max_level_1d</span><span class="p">[</span><span class="n">jj</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">index</span><span class="p">[</span><span class="n">jj</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="c1"># basis values in other directions</span>
            <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">dd</span><span class="o">!=</span><span class="n">jj</span><span class="p">:</span>
                    <span class="n">basis_vals</span><span class="o">*=</span><span class="n">basis_vals_1d</span><span class="p">[</span><span class="n">dd</span><span class="p">][:,</span><span class="n">index</span><span class="p">[</span><span class="n">dd</span><span class="p">]]</span>
            
            <span class="n">values</span><span class="p">[(</span><span class="n">jj</span><span class="p">)</span><span class="o">*</span><span class="n">num_samples</span><span class="p">:(</span><span class="n">jj</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">num_samples</span><span class="p">,</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">basis_vals</span>
    <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="evaluate_multivariate_orthonormal_polynomial"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.evaluate_multivariate_orthonormal_polynomial.html#pyapprox.multivariate_polynomials.evaluate_multivariate_orthonormal_polynomial">[docs]</a><span class="k">def</span> <span class="nf">evaluate_multivariate_orthonormal_polynomial</span><span class="p">(</span>
        <span class="n">samples</span><span class="p">,</span><span class="n">indices</span><span class="p">,</span><span class="n">recursion_coeffs</span><span class="p">,</span><span class="n">deriv_order</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">basis_type_index_map</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Evaluate a multivaiate orthonormal polynomial and its s-derivatives </span>
<span class="sd">    (s=1,...,num_derivs) using a three-term recurrence coefficients.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    samples : np.ndarray (num_vars, num_samples)</span>
<span class="sd">        Samples at which to evaluate the polynomial</span>

<span class="sd">    indices : np.ndarray (num_vars, num_indices)</span>
<span class="sd">        The exponents of each polynomial term</span>

<span class="sd">    recursion_coeffs : np.ndarray (num_indices,2)</span>
<span class="sd">        The coefficients of each monomial term</span>

<span class="sd">    deriv_order : integer in [0,1]</span>
<span class="sd">       The maximum order of the derivatives to evaluate.</span>

<span class="sd">    Return</span>
<span class="sd">    ------</span>
<span class="sd">    values : np.ndarray (1+deriv_order*num_samples,num_indices)</span>
<span class="sd">        The values of the polynomials at the samples</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_vars</span><span class="p">,</span> <span class="n">num_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span>
    <span class="k">assert</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">num_vars</span>
    <span class="k">assert</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span>
    <span class="c1">#assert recursion_coeffs.shape[0]&gt;indices.max()</span>
    <span class="n">max_level_1d</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">assert</span> <span class="n">deriv_order</span><span class="o">&gt;=</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">deriv_order</span><span class="o">&lt;=</span><span class="mi">1</span>

    <span class="c1"># My cython implementaion is currently slower than pure python found here</span>
    <span class="c1"># try:</span>
    <span class="c1">#     from pyapprox.cython.multivariate_polynomials import \</span>
    <span class="c1">#         evaluate_multivariate_orthonormal_polynomial_pyx</span>
    <span class="c1">#     return evaluate_multivariate_orthonormal_polynomial_pyx(</span>
    <span class="c1">#         samples,indices,recursion_coeffs,deriv_order)</span>
    <span class="c1"># except:</span>
    <span class="c1">#     print(&#39;evaluate_multivariate_orthonormal_polynomial extension failed&#39;)</span>
    
    <span class="c1"># precompute 1D basis functions for faster evaluation of</span>
    <span class="c1"># multivariate terms</span>

    <span class="n">precompute_values</span> <span class="o">=</span> <span class="n">precompute_multivariate_orthonormal_polynomial_univariate_values</span>
    <span class="n">compute_values</span> <span class="o">=</span>  <span class="n">evaluate_multivariate_orthonormal_polynomial_values</span>
    <span class="n">compute_derivs</span> <span class="o">=</span> <span class="n">evaluate_multivariate_orthonormal_polynomial_derivs</span>

    <span class="c1"># precompute_values = precompute_multivariate_orthonormal_polynomial_univariate_values_deprecated</span>
    <span class="c1"># compute_values =  evaluate_multivariate_orthonormal_polynomial_values_deprecated</span>
    <span class="c1"># compute_derivs = evaluate_multivariate_orthonormal_polynomial_derivs_deprecated</span>

    <span class="n">basis_vals_1d</span> <span class="o">=</span> <span class="n">precompute_values</span><span class="p">(</span>
        <span class="n">samples</span><span class="p">,</span><span class="n">indices</span><span class="p">,</span><span class="n">recursion_coeffs</span><span class="p">,</span><span class="n">deriv_order</span><span class="p">,</span><span class="n">basis_type_index_map</span><span class="p">)</span>
    
    <span class="n">num_samples</span> <span class="o">=</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">compute_values</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span><span class="n">basis_vals_1d</span><span class="p">,</span><span class="n">num_samples</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">deriv_order</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">values</span>

    <span class="n">derivs</span> <span class="o">=</span> <span class="n">compute_derivs</span><span class="p">(</span>
        <span class="n">indices</span><span class="p">,</span><span class="n">max_level_1d</span><span class="p">,</span><span class="n">basis_vals_1d</span><span class="p">,</span><span class="n">num_samples</span><span class="p">,</span><span class="n">deriv_order</span><span class="p">)</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">values</span><span class="p">,</span><span class="n">derivs</span><span class="p">])</span>
        
    <span class="k">return</span> <span class="n">values</span></div>

<div class="viewcode-block" id="get_recursion_coefficients"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.get_recursion_coefficients.html#pyapprox.multivariate_polynomials.get_recursion_coefficients">[docs]</a><span class="k">def</span> <span class="nf">get_recursion_coefficients</span><span class="p">(</span>
        <span class="n">opts</span><span class="p">,</span>
        <span class="n">num_coefs</span><span class="p">,</span>
        <span class="n">numerically_generated_poly_accuracy_tolerance</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
    
    <span class="n">poly_type</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;poly_type&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">var_type</span><span class="o">=</span><span class="kc">None</span>
    <span class="k">if</span> <span class="n">poly_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">var_type</span><span class="o">=</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;rv_type&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">poly_type</span><span class="o">==</span><span class="s1">&#39;legendre&#39;</span> <span class="ow">or</span> <span class="n">var_type</span><span class="o">==</span><span class="s1">&#39;uniform&#39;</span><span class="p">:</span>
        <span class="n">recursion_coeffs</span> <span class="o">=</span> <span class="n">jacobi_recurrence</span><span class="p">(</span>
            <span class="n">num_coefs</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">poly_type</span><span class="o">==</span><span class="s1">&#39;jacobi&#39;</span> <span class="ow">or</span> <span class="n">var_type</span><span class="o">==</span><span class="s1">&#39;beta&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">poly_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">alpha_poly</span><span class="p">,</span><span class="n">beta_poly</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;alpha_poly&#39;</span><span class="p">],</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;beta_poly&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">alpha_poly</span><span class="p">,</span><span class="n">beta_poly</span><span class="o">=</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;shapes&#39;</span><span class="p">][</span><span class="s1">&#39;b&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;shapes&#39;</span><span class="p">][</span><span class="s1">&#39;a&#39;</span><span class="p">]</span><span class="o">-</span><span class="mi">1</span>
        <span class="n">recursion_coeffs</span> <span class="o">=</span> <span class="n">jacobi_recurrence</span><span class="p">(</span>
            <span class="n">num_coefs</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="n">alpha_poly</span><span class="p">,</span><span class="n">beta</span><span class="o">=</span><span class="n">beta_poly</span><span class="p">,</span><span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">poly_type</span><span class="o">==</span><span class="s1">&#39;hermite&#39;</span> <span class="ow">or</span> <span class="n">var_type</span><span class="o">==</span><span class="s1">&#39;norm&#39;</span><span class="p">:</span>
        <span class="n">recursion_coeffs</span> <span class="o">=</span> <span class="n">hermite_recurrence</span><span class="p">(</span>
            <span class="n">num_coefs</span><span class="p">,</span> <span class="n">rho</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">probability</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">poly_type</span><span class="o">==</span><span class="s1">&#39;krawtchouk&#39;</span> <span class="ow">or</span> <span class="n">var_type</span><span class="o">==</span><span class="s1">&#39;binom&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">poly_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;shapes&#39;</span><span class="p">]</span> 
        <span class="n">n</span><span class="p">,</span><span class="n">p</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">],</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
        <span class="n">num_coefs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_coefs</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
        <span class="n">recursion_coeffs</span> <span class="o">=</span> <span class="n">krawtchouk_recurrence</span><span class="p">(</span>
            <span class="n">num_coefs</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">p</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">poly_type</span><span class="o">==</span><span class="s1">&#39;hahn&#39;</span> <span class="ow">or</span> <span class="n">var_type</span><span class="o">==</span><span class="s1">&#39;hypergeom&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">poly_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">apoly</span><span class="p">,</span><span class="n">bpoly</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;alpha_poly&#39;</span><span class="p">],</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;beta_poly&#39;</span><span class="p">]</span>
            <span class="n">N</span><span class="o">=</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">M</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">N</span><span class="o">=</span><span class="p">[</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;shapes&#39;</span><span class="p">][</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;N&#39;</span><span class="p">]]</span>
            <span class="n">apoly</span><span class="p">,</span><span class="n">bpoly</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span><span class="o">-</span><span class="n">M</span><span class="o">-</span><span class="mi">1</span><span class="o">+</span><span class="n">n</span>
        <span class="n">num_coefs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_coefs</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
        <span class="n">recursion_coeffs</span> <span class="o">=</span> <span class="n">hahn_recurrence</span><span class="p">(</span>
            <span class="n">num_coefs</span><span class="p">,</span><span class="n">N</span><span class="p">,</span><span class="n">apoly</span><span class="p">,</span><span class="n">bpoly</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">poly_type</span><span class="o">==</span><span class="s1">&#39;discrete_chebyshev&#39;</span> <span class="ow">or</span> <span class="n">var_type</span><span class="o">==</span><span class="s1">&#39;discrete_chebyshev&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">poly_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">N</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;shapes&#39;</span><span class="p">][</span><span class="s1">&#39;xk&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;shapes&#39;</span><span class="p">][</span><span class="s1">&#39;xk&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>
            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;shapes&#39;</span><span class="p">][</span><span class="s1">&#39;pk&#39;</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">/</span><span class="n">N</span><span class="p">)</span>
        <span class="n">num_coefs</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">num_coefs</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
        <span class="n">recursion_coeffs</span> <span class="o">=</span> <span class="n">discrete_chebyshev_recurrence</span><span class="p">(</span>
            <span class="n">num_coefs</span><span class="p">,</span><span class="n">N</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">poly_type</span><span class="o">==</span><span class="s1">&#39;discrete_numeric&#39;</span> <span class="ow">or</span> <span class="n">var_type</span><span class="o">==</span><span class="s1">&#39;float_rv_discrete&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">poly_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">opts</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;shapes&#39;</span><span class="p">]</span>
        <span class="n">xk</span><span class="p">,</span><span class="n">pk</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;xk&#39;</span><span class="p">],</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;pk&#39;</span><span class="p">]</span>
        <span class="c1">#shapes[&#39;xk&#39;] will be in [0,1] but canonical domain is [-1,1]</span>
        <span class="n">xk</span> <span class="o">=</span> <span class="n">xk</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">assert</span> <span class="n">xk</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">&gt;=-</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">xk</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">&lt;=</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">num_coefs</span><span class="o">&gt;</span><span class="n">xk</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s1">&#39;Number of coefs requested is larger than number of &#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="s1">&#39;probability masses&#39;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">recursion_coeffs</span>  <span class="o">=</span> <span class="n">modified_chebyshev_orthonormal</span><span class="p">(</span>
            <span class="n">num_coefs</span><span class="p">,[</span><span class="n">xk</span><span class="p">,</span><span class="n">pk</span><span class="p">])</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">evaluate_orthonormal_polynomial_1d</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">xk</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">),</span><span class="n">num_coefs</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">recursion_coeffs</span><span class="p">)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">((</span><span class="n">p</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">p</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">num_coefs</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">error</span> <span class="o">&gt;</span> <span class="n">numerically_generated_poly_accuracy_tolerance</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;basis created is ill conditioned. &#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Max error: </span><span class="si">{</span><span class="n">error</span><span class="si">}</span><span class="s1">. Max terms: </span><span class="si">{</span><span class="n">xk</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">, &#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;Terms requested: </span><span class="si">{</span><span class="n">num_coefs</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">poly_type</span><span class="o">==</span><span class="s1">&#39;monomial&#39;</span><span class="p">:</span>
        <span class="n">recursion_coeffs</span><span class="o">=</span><span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">poly_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;poly_type (</span><span class="si">%s</span><span class="s1">) not supported&#39;</span><span class="o">%</span><span class="n">poly_type</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;var_type (</span><span class="si">%s</span><span class="s1">) not supported&#39;</span><span class="o">%</span><span class="n">var_type</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">recursion_coeffs</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion">[docs]</a><span class="k">class</span> <span class="nc">PolynomialChaosExpansion</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis_type_index_map</span><span class="o">=</span><span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">basis_type_var_indices</span><span class="o">=</span><span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numerically_generated_poly_accuracy_tolerance</span><span class="o">=</span><span class="kc">None</span>
    
    <span class="k">def</span> <span class="fm">__mul__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">other</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">poly1</span><span class="o">=</span><span class="bp">self</span>
            <span class="n">poly2</span><span class="o">=</span><span class="n">other</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">poly1</span><span class="o">=</span><span class="n">other</span>
            <span class="n">poly2</span><span class="o">=</span><span class="bp">self</span>
        <span class="kn">import</span> <span class="nn">copy</span>
        <span class="n">poly1</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">poly1</span><span class="p">)</span>
        <span class="n">poly2</span><span class="o">=</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">poly2</span><span class="p">)</span>
        <span class="n">max_degrees1</span> <span class="o">=</span> <span class="n">poly1</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">max_degrees2</span> <span class="o">=</span> <span class="n">poly2</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1">#print(&#39;###&#39;)</span>
        <span class="c1">#print(max_degrees1,max_degrees2)</span>
        <span class="n">product_coefs_1d</span> <span class="o">=</span> <span class="n">compute_product_coeffs_1d_for_each_variable</span><span class="p">(</span>
            <span class="n">poly1</span><span class="p">,</span><span class="n">max_degrees1</span><span class="p">,</span><span class="n">max_degrees2</span><span class="p">)</span>
        <span class="c1">#print(product_coefs_1d)</span>
        
        <span class="n">indices</span><span class="p">,</span><span class="n">coefs</span><span class="o">=</span><span class="n">multiply_multivariate_orthonormal_polynomial_expansions</span><span class="p">(</span>
            <span class="n">product_coefs_1d</span><span class="p">,</span><span class="n">poly1</span><span class="o">.</span><span class="n">get_indices</span><span class="p">(),</span><span class="n">poly1</span><span class="o">.</span><span class="n">get_coefficients</span><span class="p">(),</span>
            <span class="n">poly2</span><span class="o">.</span><span class="n">get_indices</span><span class="p">(),</span><span class="n">poly2</span><span class="o">.</span><span class="n">get_coefficients</span><span class="p">())</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span><span class="c1">#get_polynomial_from_variable(self.var_trans.variable)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">set_indices</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">set_coefficients</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">poly</span>

    <span class="k">def</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="n">indices_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span><span class="n">other</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">coefs_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">,</span><span class="n">other</span><span class="o">.</span><span class="n">coefficients</span><span class="p">]</span>
        <span class="n">indices</span><span class="p">,</span> <span class="n">coefs</span> <span class="o">=</span> <span class="n">add_polynomials</span><span class="p">(</span><span class="n">indices_list</span><span class="p">,</span> <span class="n">coefs_list</span><span class="p">)</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">get_polynomial_from_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_trans</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">set_indices</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">set_coefficients</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">poly</span>

    <span class="k">def</span> <span class="fm">__sub__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">other</span><span class="p">):</span>
        <span class="n">indices_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span><span class="n">other</span><span class="o">.</span><span class="n">indices</span><span class="p">]</span>
        <span class="n">coefs_list</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">,</span><span class="o">-</span><span class="n">other</span><span class="o">.</span><span class="n">coefficients</span><span class="p">]</span>
        <span class="n">indices</span><span class="p">,</span> <span class="n">coefs</span> <span class="o">=</span> <span class="n">add_polynomials</span><span class="p">(</span><span class="n">indices_list</span><span class="p">,</span> <span class="n">coefs_list</span><span class="p">)</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">get_polynomial_from_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_trans</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">set_indices</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">set_coefficients</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">poly</span>

    <span class="k">def</span> <span class="fm">__pow__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">order</span><span class="p">):</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">get_polynomial_from_variable</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">var_trans</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">order</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">set_indices</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vars</span><span class="p">(),</span><span class="mi">1</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">))</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">set_coefficients</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
            <span class="k">return</span> <span class="n">poly</span>            

        <span class="kn">import</span> <span class="nn">copy</span>
        <span class="n">poly</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">order</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">poly</span><span class="o">=</span><span class="n">poly</span><span class="o">*</span><span class="bp">self</span>
        <span class="k">return</span> <span class="n">poly</span>
    
<div class="viewcode-block" id="PolynomialChaosExpansion.configure"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.configure">[docs]</a>    <span class="k">def</span> <span class="nf">configure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">opts</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_opts</span><span class="o">=</span><span class="n">opts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">var_trans</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;var_trans&#39;</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_trans</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;must set var_trans&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_degree</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vars</span><span class="p">(),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">numerically_generated_poly_accuracy_tolerance</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
            <span class="s1">&#39;numerically_generated_poly_accuracy_tolerance&#39;</span><span class="p">,</span><span class="mf">1e-12</span><span class="p">)</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.update_recursion_coefficients"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.update_recursion_coefficients">[docs]</a>    <span class="k">def</span> <span class="nf">update_recursion_coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num_coefs_per_var</span><span class="p">,</span><span class="n">opts</span><span class="p">):</span>
        <span class="n">num_coefs_per_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">num_coefs_per_var</span><span class="p">)</span>
        <span class="n">initializing</span><span class="o">=</span><span class="kc">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis_type_index_map</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initializing</span><span class="o">=</span><span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">basis_type_index_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vars</span><span class="p">()),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;poly_types&#39;</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
            <span class="n">ii</span><span class="o">=</span><span class="mi">0</span>
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">poly_opts</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;poly_types&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">initializing</span> <span class="ow">or</span> <span class="p">(</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">num_coefs_per_var</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basis_type_var_indices</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span><span class="o">&gt;</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">max_degree</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basis_type_var_indices</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span><span class="o">+</span><span class="mi">1</span><span class="p">))):</span>
                    <span class="k">if</span> <span class="n">initializing</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">basis_type_var_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                            <span class="n">poly_opts</span><span class="p">[</span><span class="s1">&#39;var_nums&#39;</span><span class="p">])</span>
                    <span class="n">num_coefs</span><span class="o">=</span><span class="n">num_coefs_per_var</span><span class="p">[</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">basis_type_var_indices</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
                    <span class="n">recursion_coeffs_ii</span> <span class="o">=</span> <span class="n">get_recursion_coefficients</span><span class="p">(</span>
                        <span class="n">poly_opts</span><span class="p">,</span><span class="n">num_coefs</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">numerically_generated_poly_accuracy_tolerance</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">recursion_coeffs_ii</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="c1"># recursion coefficients will be None is returned if</span>
                        <span class="c1"># monomial basis is specified. Only allow monomials to</span>
                        <span class="c1"># be used if all variables use monomial basis</span>
                        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">opts</span><span class="p">[</span><span class="s1">&#39;poly_types&#39;</span><span class="p">])</span><span class="o">==</span><span class="mi">1</span>
                    <span class="k">if</span> <span class="n">initializing</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">recursion_coeffs_ii</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="o">=</span> <span class="n">recursion_coeffs_ii</span>
                <span class="c1"># extract variables indices for which basis is to be used</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">basis_type_index_map</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">basis_type_var_indices</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span><span class="o">=</span><span class="n">ii</span>
                <span class="n">ii</span><span class="o">+=</span><span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># when only one type of basis is assumed then allow poly_type to</span>
            <span class="c1"># be elevated to top level of options dictionary.</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="o">=</span><span class="p">[</span><span class="n">get_recursion_coefficients</span><span class="p">(</span>
                <span class="n">opts</span><span class="p">,</span><span class="n">num_coefs_per_var</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">numerically_generated_poly_accuracy_tolerance</span><span class="p">)]</span></div>
        
        
<div class="viewcode-block" id="PolynomialChaosExpansion.set_indices"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.set_indices">[docs]</a>    <span class="k">def</span> <span class="nf">set_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">indices</span><span class="p">):</span>
        <span class="c1">#assert indices.dtype==int</span>
        <span class="k">if</span> <span class="n">indices</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">=</span><span class="n">indices</span>
        <span class="k">assert</span> <span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vars</span><span class="p">()</span>
        <span class="n">max_degree</span> <span class="o">=</span> <span class="n">indices</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">max_degree</span><span class="o">&lt;</span><span class="n">max_degree</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_recursion_coefficients</span><span class="p">(</span><span class="n">max_degree</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">config_opts</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">max_degree</span><span class="o">=</span><span class="n">max_degree</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.basis_matrix"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.basis_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">basis_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">samples</span><span class="p">,</span><span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
        <span class="k">assert</span> <span class="n">samples</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span>
        <span class="k">assert</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">num_vars</span><span class="p">()</span>
        <span class="n">canonical_samples</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_trans</span><span class="o">.</span><span class="n">map_to_canonical_space</span><span class="p">(</span>
            <span class="n">samples</span><span class="p">)</span>
        <span class="n">basis_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">canonical_basis_matrix</span><span class="p">(</span><span class="n">canonical_samples</span><span class="p">,</span><span class="n">opts</span><span class="p">)</span>
        <span class="n">deriv_order</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deriv_order&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">deriv_order</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">basis_matrix</span><span class="p">[</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,:]</span><span class="o">=</span>\
              <span class="bp">self</span><span class="o">.</span><span class="n">var_trans</span><span class="o">.</span><span class="n">map_derivatives_from_canonical_space</span><span class="p">(</span>
                <span class="n">basis_matrix</span><span class="p">[</span><span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:,:])</span>
        <span class="k">return</span> <span class="n">basis_matrix</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.canonical_basis_matrix"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.canonical_basis_matrix">[docs]</a>    <span class="k">def</span> <span class="nf">canonical_basis_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">canonical_samples</span><span class="p">,</span><span class="n">opts</span><span class="o">=</span><span class="nb">dict</span><span class="p">()):</span>
        <span class="n">deriv_order</span> <span class="o">=</span> <span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deriv_order&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">basis_matrix</span> <span class="o">=</span> <span class="n">evaluate_multivariate_orthonormal_polynomial</span><span class="p">(</span>
                <span class="n">canonical_samples</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="p">,</span>
                <span class="n">deriv_order</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">basis_type_index_map</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">basis_matrix</span> <span class="o">=</span> <span class="n">monomial_basis_matrix</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span><span class="n">canonical_samples</span><span class="p">,</span><span class="n">deriv_order</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">basis_matrix</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.jacobian"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.jacobian">[docs]</a>    <span class="k">def</span> <span class="nf">jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">sample</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">sample</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span>
        <span class="n">derivative_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis_matrix</span><span class="p">(</span>
            <span class="n">sample</span><span class="p">,{</span><span class="s1">&#39;deriv_order&#39;</span><span class="p">:</span><span class="mi">1</span><span class="p">})[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">jac</span> <span class="o">=</span> <span class="n">derivative_matrix</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">jac</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.set_coefficients"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.set_coefficients">[docs]</a>    <span class="k">def</span> <span class="nf">set_coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">coefficients</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span>
        <span class="k">assert</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">num_terms</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span> <span class="o">=</span> <span class="n">coefficients</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.get_coefficients"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.get_coefficients">[docs]</a>    <span class="k">def</span> <span class="nf">get_coefficients</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.get_indices"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.get_indices">[docs]</a>    <span class="k">def</span> <span class="nf">get_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.value"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.value">[docs]</a>    <span class="k">def</span> <span class="nf">value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">samples</span><span class="p">):</span>
        <span class="n">basis_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">basis_matrix</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">basis_matrix</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">)</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.num_vars"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.num_vars">[docs]</a>    <span class="k">def</span> <span class="nf">num_vars</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">var_trans</span><span class="o">.</span><span class="n">num_vars</span><span class="p">()</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.__call__"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.__call__">[docs]</a>    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">samples</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">samples</span><span class="p">)</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.mean"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.mean">[docs]</a>    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the mean of the polynomial chaos expansion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        mean : np.ndarray (nqoi)</span>
<span class="sd">            The mean of each quantitity of interest</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">,:]</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.variance"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.variance">[docs]</a>    <span class="k">def</span> <span class="nf">variance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the variance of the polynomial chaos expansion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        var : np.ndarray (nqoi)</span>
<span class="sd">            The variance of each quantitity of interest</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">var</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.covariance"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.covariance">[docs]</a>    <span class="k">def</span> <span class="nf">covariance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the covariance between each quantity of interest of the </span>
<span class="sd">        polynomial chaos expansion</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        covar : np.ndarray (nqoi)</span>
<span class="sd">            The covariance between each quantitity of interest</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nqoi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">covar</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="mi">1</span><span class="p">:,:])</span>
        <span class="k">return</span> <span class="n">covar</span></div>

<div class="viewcode-block" id="PolynomialChaosExpansion.num_terms"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.PolynomialChaosExpansion.html#pyapprox.multivariate_polynomials.PolynomialChaosExpansion.num_terms">[docs]</a>    <span class="k">def</span> <span class="nf">num_terms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># truncated svd creates basis with num_terms &lt;= num_indices</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span></div></div>
    
<span class="kn">from</span> <span class="nn">pyapprox.utilities</span> <span class="kn">import</span> <span class="n">get_tensor_product_quadrature_rule</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">pyapprox.orthonormal_polynomials_1d</span> <span class="kn">import</span> <span class="n">gauss_quadrature</span>
<div class="viewcode-block" id="get_univariate_quadrature_rules_from_pce"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.get_univariate_quadrature_rules_from_pce.html#pyapprox.multivariate_polynomials.get_univariate_quadrature_rules_from_pce">[docs]</a><span class="k">def</span> <span class="nf">get_univariate_quadrature_rules_from_pce</span><span class="p">(</span><span class="n">pce</span><span class="p">,</span><span class="n">degrees</span><span class="p">):</span>
    <span class="n">num_vars</span> <span class="o">=</span> <span class="n">pce</span><span class="o">.</span><span class="n">num_vars</span><span class="p">()</span>
    <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">degrees</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">degrees</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">num_vars</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">degrees</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">degrees</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">*</span><span class="n">num_vars</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">pce</span><span class="o">.</span><span class="n">max_degree</span><span class="o">&lt;</span><span class="n">degrees</span><span class="p">):</span>
        <span class="n">pce</span><span class="o">.</span><span class="n">update_recursion_coefficients</span><span class="p">(</span><span class="n">degrees</span><span class="p">,</span><span class="n">pce</span><span class="o">.</span><span class="n">config_opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pce</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="c1"># update_recursion_coefficients may not return coefficients</span>
        <span class="c1"># up to degree specified if using recursion for polynomial</span>
        <span class="c1"># orthogonal to a discrete variable with finite non-zero</span>
        <span class="c1"># probability measures</span>
        <span class="k">assert</span> <span class="n">pce</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="n">degrees</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">univariate_quadrature_rules</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">partial</span><span class="p">(</span><span class="n">gauss_quadrature</span><span class="p">,</span><span class="n">pce</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span><span class="o">*</span><span class="n">num_vars</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">univariate_quadrature_rules</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">):</span>
            <span class="c1"># update_recursion_coefficients may not return coefficients</span>
            <span class="c1"># up to degree specified if using recursion for polynomial</span>
            <span class="c1"># orthogonal to a discrete variable with finite non-zero</span>
            <span class="c1"># probability measures</span>
            <span class="k">assert</span> <span class="p">(</span><span class="n">pce</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="p">[</span><span class="n">basis_type_index_map</span><span class="p">[</span><span class="n">dd</span><span class="p">]]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span>
                    <span class="n">degrees</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">univariate_quadrature_rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">partial</span><span class="p">(</span><span class="n">gauss_quadrature</span><span class="p">,</span>
                        <span class="n">pce</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="p">[</span><span class="n">basis_type_index_map</span><span class="p">[</span><span class="n">dd</span><span class="p">]]))</span>
    <span class="k">return</span> <span class="n">univariate_quadrature_rules</span></div>

<div class="viewcode-block" id="get_tensor_product_quadrature_rule_from_pce"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.get_tensor_product_quadrature_rule_from_pce.html#pyapprox.multivariate_polynomials.get_tensor_product_quadrature_rule_from_pce">[docs]</a><span class="k">def</span> <span class="nf">get_tensor_product_quadrature_rule_from_pce</span><span class="p">(</span><span class="n">pce</span><span class="p">,</span><span class="n">degrees</span><span class="p">):</span>
    <span class="n">univariate_quadrature_rules</span> <span class="o">=</span> <span class="n">get_univariate_quadrature_rules_from_pce</span><span class="p">(</span>
        <span class="n">pce</span><span class="p">,</span><span class="n">degrees</span><span class="p">)</span>
    <span class="n">canonical_samples</span><span class="p">,</span><span class="n">weights</span> <span class="o">=</span> \
        <span class="n">get_tensor_product_quadrature_rule</span><span class="p">(</span>
        <span class="n">degrees</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">num_vars</span><span class="p">,</span><span class="n">univariate_quadrature_rules</span><span class="p">)</span>
    <span class="n">samples</span> <span class="o">=</span> <span class="n">pce</span><span class="o">.</span><span class="n">var_trans</span><span class="o">.</span><span class="n">map_from_canonical_space</span><span class="p">(</span>
        <span class="n">canonical_samples</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">samples</span><span class="p">,</span> <span class="n">weights</span></div>

<span class="kn">from</span> <span class="nn">pyapprox.variables</span> <span class="kn">import</span> <span class="n">get_distribution_info</span>
<div class="viewcode-block" id="define_poly_options_from_variable"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.define_poly_options_from_variable.html#pyapprox.multivariate_polynomials.define_poly_options_from_variable">[docs]</a><span class="k">def</span> <span class="nf">define_poly_options_from_variable</span><span class="p">(</span><span class="n">variable</span><span class="p">):</span>
    <span class="n">basis_opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">variable</span><span class="o">.</span><span class="n">unique_variables</span><span class="p">)):</span>
        <span class="n">var</span> <span class="o">=</span> <span class="n">variable</span><span class="o">.</span><span class="n">unique_variables</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">name</span><span class="p">,</span> <span class="n">scales</span><span class="p">,</span> <span class="n">shapes</span> <span class="o">=</span> <span class="n">get_distribution_info</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
        <span class="n">opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;rv_type&#39;</span><span class="p">:</span><span class="n">name</span><span class="p">,</span><span class="s1">&#39;shapes&#39;</span><span class="p">:</span><span class="n">shapes</span><span class="p">,</span>
                <span class="s1">&#39;var_nums&#39;</span><span class="p">:</span><span class="n">variable</span><span class="o">.</span><span class="n">unique_variable_indices</span><span class="p">[</span><span class="n">ii</span><span class="p">]}</span>
        <span class="n">basis_opts</span><span class="p">[</span><span class="s1">&#39;basis</span><span class="si">%d</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">ii</span><span class="p">]</span><span class="o">=</span><span class="n">opts</span>
    <span class="k">return</span> <span class="n">basis_opts</span></div>

<div class="viewcode-block" id="define_poly_options_from_variable_transformation"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.define_poly_options_from_variable_transformation.html#pyapprox.multivariate_polynomials.define_poly_options_from_variable_transformation">[docs]</a><span class="k">def</span> <span class="nf">define_poly_options_from_variable_transformation</span><span class="p">(</span><span class="n">var_trans</span><span class="p">):</span>
    <span class="n">pce_opts</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;var_trans&#39;</span><span class="p">:</span><span class="n">var_trans</span><span class="p">}</span>
    <span class="n">basis_opts</span> <span class="o">=</span> <span class="n">define_poly_options_from_variable</span><span class="p">(</span><span class="n">var_trans</span><span class="o">.</span><span class="n">variable</span><span class="p">)</span>
    <span class="n">pce_opts</span><span class="p">[</span><span class="s1">&#39;poly_types&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">basis_opts</span>
    <span class="k">return</span> <span class="n">pce_opts</span></div>
    
<div class="viewcode-block" id="conditional_moments_of_polynomial_chaos_expansion"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.conditional_moments_of_polynomial_chaos_expansion.html#pyapprox.multivariate_polynomials.conditional_moments_of_polynomial_chaos_expansion">[docs]</a><span class="k">def</span> <span class="nf">conditional_moments_of_polynomial_chaos_expansion</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span><span class="n">samples</span><span class="p">,</span><span class="n">inactive_idx</span><span class="p">,</span><span class="n">return_variance</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return mean and variance of polynomial chaos expansion with some variables</span>
<span class="sd">    fixed at specified values.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    poly: PolynomialChaosExpansion</span>
<span class="sd">        The polynomial used to compute moments</span>

<span class="sd">    inactive_idx : np.ndarray (ninactive_vars)</span>
<span class="sd">        The indices of the fixed variables</span>

<span class="sd">    samples : np.ndarray (ninactive_vars)</span>
<span class="sd">        The samples of the inacive dimensions fixed when computing moments</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    mean : np.ndarray</span>
<span class="sd">       The conditional mean (num_qoi)</span>

<span class="sd">    variance : np.ndarray</span>
<span class="sd">       The conditional variance (num_qoi). Only returned if </span>
<span class="sd">       return_variance=True. Computing variance is significantly slower than</span>
<span class="sd">       computing mean. TODO check it is indeed slower</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">inactive_idx</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">samples</span><span class="o">.</span><span class="n">ndim</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">samples</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span>
    <span class="k">assert</span> <span class="n">poly</span><span class="o">.</span><span class="n">coefficients</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
    <span class="n">coef</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">get_coefficients</span><span class="p">()</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">get_indices</span><span class="p">()</span>

    <span class="c1"># precompute 1D basis functions for faster evaluation of</span>
    <span class="c1"># multivariate terms</span>
    <span class="n">basis_vals_1d</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inactive_idx</span><span class="p">)):</span>
        <span class="n">basis_vals_1d_dd</span><span class="o">=</span><span class="n">evaluate_orthonormal_polynomial_1d</span><span class="p">(</span>
            <span class="n">samples</span><span class="p">[</span><span class="n">dd</span><span class="p">,:],</span><span class="n">indices</span><span class="p">[</span><span class="n">inactive_idx</span><span class="p">[</span><span class="n">dd</span><span class="p">],:]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">basis_type_index_map</span><span class="p">[</span><span class="n">inactive_idx</span><span class="p">[</span><span class="n">dd</span><span class="p">]]])</span>
        <span class="n">basis_vals_1d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">basis_vals_1d_dd</span><span class="p">)</span>

    <span class="n">active_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">num_vars</span><span class="p">()),</span><span class="n">inactive_idx</span><span class="p">)</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">coef_ii</span> <span class="o">=</span> <span class="n">coef</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="c1"># this intentionally updates the coef matrix</span>
        <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inactive_idx</span><span class="p">)):</span>
            <span class="n">coef_ii</span> <span class="o">*=</span> <span class="n">basis_vals_1d</span><span class="p">[</span><span class="n">dd</span><span class="p">][</span><span class="mi">0</span><span class="p">,</span><span class="n">index</span><span class="p">[</span><span class="n">inactive_idx</span><span class="p">[</span><span class="n">dd</span><span class="p">]]]</span>
        <span class="k">if</span> <span class="n">index</span><span class="p">[</span><span class="n">active_idx</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="n">mean</span> <span class="o">+=</span> <span class="n">coef_ii</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">return_variance</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">mean</span>
    
    <span class="n">unique_indices</span><span class="p">,</span><span class="n">repeated_idx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
        <span class="n">indices</span><span class="p">[</span><span class="n">active_idx</span><span class="p">,:],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">new_coef</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">unique_indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">coef</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">repeated_idx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="n">new_coef</span><span class="p">[</span><span class="n">repeated_idx</span><span class="p">[</span><span class="n">ii</span><span class="p">]]</span><span class="o">+=</span><span class="n">coef</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
    <span class="n">variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">new_coef</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">-</span><span class="n">mean</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">mean</span><span class="p">,</span> <span class="n">variance</span></div>

<div class="viewcode-block" id="remove_variables_from_polynomial_chaos_expansion"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.remove_variables_from_polynomial_chaos_expansion.html#pyapprox.multivariate_polynomials.remove_variables_from_polynomial_chaos_expansion">[docs]</a><span class="k">def</span> <span class="nf">remove_variables_from_polynomial_chaos_expansion</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span><span class="n">inactive_idx</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is not optimal. It will recreate the options</span>
<span class="sd">    used to configure the polynomial. Any recursion coefficients </span>
<span class="sd">    calculated which are still relevant will need to be computed.</span>
<span class="sd">    This is probably not a large overhead though</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fixed_pce</span> <span class="o">=</span> <span class="n">PolynomialChaosExpansion</span><span class="p">()</span>
    <span class="n">opts</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">config_opts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;var_trans&#39;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">AffineRandomVariableTransformation</span><span class="p">(</span>
        <span class="n">IndependentMultivariateRandomVariable</span><span class="p">(</span>
            <span class="n">poly</span><span class="o">.</span><span class="n">var_trans</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">all_variables</span><span class="p">()[</span><span class="n">inactive_idx</span><span class="p">]))</span>

    <span class="k">if</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;poly_types&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">poly_opts</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">[</span><span class="s1">&#39;poly_types&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">var_nums</span> <span class="o">=</span> <span class="n">poly_opts</span><span class="p">[</span><span class="s1">&#39;var_nums&#39;</span><span class="p">]</span>
            <span class="n">poly_opts</span><span class="p">[</span><span class="s1">&#39;var_nums&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
                <span class="p">[</span><span class="n">var_nums</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">var_nums</span><span class="p">))</span>
                 <span class="k">if</span> <span class="n">var_nums</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">inactive_idx</span><span class="p">])</span>
    <span class="c1">#else # no need to do anything same basis is used for all variables</span>
    
    <span class="n">fixed_pce</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">poly</span><span class="o">.</span><span class="n">indices</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">active_idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">poly</span><span class="o">.</span><span class="n">num_vars</span><span class="p">()),</span><span class="n">inactive_idx</span><span class="p">)</span>
        <span class="n">reduced_indices</span> <span class="o">=</span> <span class="n">indices</span><span class="p">[</span><span class="n">active_idx</span><span class="p">,:]</span>
    <span class="n">pce</span><span class="o">.</span><span class="n">set_indices</span><span class="p">(</span><span class="n">reduced_indices</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">pce</span><span class="o">.</span><span class="n">coefficients</span> <span class="ow">is</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="n">fixed_pce</span></div>

<span class="kn">from</span> <span class="nn">pyapprox.variable_transformations</span> <span class="kn">import</span> \
    <span class="n">AffineRandomVariableTransformation</span>
<div class="viewcode-block" id="get_polynomial_from_variable"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.get_polynomial_from_variable.html#pyapprox.multivariate_polynomials.get_polynomial_from_variable">[docs]</a><span class="k">def</span> <span class="nf">get_polynomial_from_variable</span><span class="p">(</span><span class="n">variable</span><span class="p">):</span>
    <span class="n">var_trans</span> <span class="o">=</span> <span class="n">AffineRandomVariableTransformation</span><span class="p">(</span>
        <span class="n">variable</span><span class="p">)</span>
    <span class="n">poly</span> <span class="o">=</span> <span class="n">PolynomialChaosExpansion</span><span class="p">()</span>
    <span class="n">poly_opts</span> <span class="o">=</span> <span class="n">define_poly_options_from_variable_transformation</span><span class="p">(</span><span class="n">var_trans</span><span class="p">)</span>
    <span class="n">poly</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">poly_opts</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">poly</span></div>

<div class="viewcode-block" id="compute_univariate_orthonormal_basis_products"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.compute_univariate_orthonormal_basis_products.html#pyapprox.multivariate_polynomials.compute_univariate_orthonormal_basis_products">[docs]</a><span class="k">def</span> <span class="nf">compute_univariate_orthonormal_basis_products</span><span class="p">(</span><span class="n">get_recursion_coefficients</span><span class="p">,</span>
                                                  <span class="n">max_degree1</span><span class="p">,</span><span class="n">max_degree2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute all the products of univariate orthonormal bases and re-express </span>
<span class="sd">    them as expansions using the orthnormal basis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">assert</span> <span class="n">max_degree1</span><span class="o">&gt;=</span><span class="n">max_degree2</span>
    <span class="n">max_degree</span> <span class="o">=</span> <span class="n">max_degree1</span><span class="o">+</span><span class="n">max_degree2</span>
    <span class="n">num_quad_points</span> <span class="o">=</span> <span class="n">max_degree</span><span class="o">+</span><span class="mi">1</span>
    
    <span class="n">recursion_coefs</span> <span class="o">=</span> <span class="n">get_recursion_coefficients</span><span class="p">(</span><span class="n">num_quad_points</span><span class="p">)</span>
    <span class="n">x_quad</span><span class="p">,</span><span class="n">w_quad</span> <span class="o">=</span> <span class="n">gauss_quadrature</span><span class="p">(</span><span class="n">recursion_coefs</span><span class="p">,</span><span class="n">num_quad_points</span><span class="p">)</span>
    <span class="n">w_quad</span> <span class="o">=</span> <span class="n">w_quad</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>

    <span class="c1"># evaluate the orthonormal basis at the quadrature points. This can</span>
    <span class="c1"># be computed once for all degrees up to the maximum degree</span>
    <span class="n">ortho_basis_matrix</span> <span class="o">=</span> <span class="n">evaluate_orthonormal_polynomial_1d</span><span class="p">(</span>
        <span class="n">x_quad</span><span class="p">,</span> <span class="n">max_degree</span><span class="p">,</span> <span class="n">recursion_coefs</span><span class="p">)</span>

    <span class="c1"># compute coefficients of orthonormal basis using pseudo</span>
    <span class="c1"># spectral projection</span>
    <span class="n">product_coefs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">d1</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_degree1</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">d2</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">d1</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">max_degree2</span><span class="o">+</span><span class="mi">1</span><span class="p">)):</span>
            <span class="n">product_vals</span> <span class="o">=</span> <span class="n">ortho_basis_matrix</span><span class="p">[:,</span><span class="n">d1</span><span class="p">]</span><span class="o">*</span><span class="n">ortho_basis_matrix</span><span class="p">[:,</span><span class="n">d2</span><span class="p">]</span>
            <span class="n">coefs</span> <span class="o">=</span> <span class="n">w_quad</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span>
                <span class="n">product_vals</span><span class="p">[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span><span class="o">*</span><span class="n">ortho_basis_matrix</span><span class="p">[:,:</span><span class="n">d1</span><span class="o">+</span><span class="n">d2</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">product_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">coefs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">product_coefs</span></div>

<div class="viewcode-block" id="compute_product_coeffs_1d_for_each_variable"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.compute_product_coeffs_1d_for_each_variable.html#pyapprox.multivariate_polynomials.compute_product_coeffs_1d_for_each_variable">[docs]</a><span class="k">def</span> <span class="nf">compute_product_coeffs_1d_for_each_variable</span><span class="p">(</span><span class="n">poly</span><span class="p">,</span><span class="n">max_degrees1</span><span class="p">,</span><span class="n">max_degrees2</span><span class="p">):</span>
    <span class="c1"># must ensure that poly1 and poly2 have the same basis types</span>
    <span class="c1"># in each dimension</span>
    <span class="n">num_vars</span> <span class="o">=</span> <span class="n">poly</span><span class="o">.</span><span class="n">num_vars</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">get_recursion_coefficients</span><span class="p">(</span><span class="n">N</span><span class="p">,</span><span class="n">dd</span><span class="p">):</span>
        <span class="n">poly</span><span class="o">.</span><span class="n">update_recursion_coefficients</span><span class="p">([</span><span class="n">N</span><span class="p">]</span><span class="o">*</span><span class="n">num_vars</span><span class="p">,</span><span class="n">poly</span><span class="o">.</span><span class="n">config_opts</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">poly</span><span class="o">.</span><span class="n">recursion_coeffs</span><span class="p">[</span><span class="n">poly</span><span class="o">.</span><span class="n">basis_type_index_map</span><span class="p">[</span><span class="n">dd</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="c1"># change this to only compute this for unique 1d polys</span>
    <span class="n">product_coefs_1d</span><span class="o">=</span><span class="p">[</span>
        <span class="n">compute_univariate_orthonormal_basis_products</span><span class="p">(</span>
            <span class="n">partial</span><span class="p">(</span><span class="n">get_recursion_coefficients</span><span class="p">,</span><span class="n">dd</span><span class="o">=</span><span class="n">dd</span><span class="p">),</span>
            <span class="n">max_degrees1</span><span class="p">[</span><span class="n">dd</span><span class="p">],</span><span class="n">max_degrees2</span><span class="p">[</span><span class="n">dd</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_vars</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">product_coefs_1d</span></div>

<div class="viewcode-block" id="compute_multivariate_orthonormal_basis_product"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.compute_multivariate_orthonormal_basis_product.html#pyapprox.multivariate_polynomials.compute_multivariate_orthonormal_basis_product">[docs]</a><span class="k">def</span> <span class="nf">compute_multivariate_orthonormal_basis_product</span><span class="p">(</span><span class="n">product_coefs_1d</span><span class="p">,</span><span class="n">poly_index_ii</span><span class="p">,</span><span class="n">poly_index_jj</span><span class="p">,</span><span class="n">max_degrees1</span><span class="p">,</span><span class="n">max_degrees2</span><span class="p">,</span><span class="n">tol</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the product of two multivariate orthonormal bases and re-express </span>
<span class="sd">    as an expansion using the orthnormal basis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">num_vars</span> <span class="o">=</span> <span class="n">poly_index_ii</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">poly_index</span><span class="o">=</span> <span class="n">poly_index_ii</span><span class="o">+</span><span class="n">poly_index_jj</span>
    <span class="n">active_vars</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">poly_index</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">active_vars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">coefs_1d</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">active_vars</span><span class="p">:</span>
            <span class="n">pii</span><span class="p">,</span><span class="n">pjj</span><span class="o">=</span><span class="n">poly_index_ii</span><span class="p">[</span><span class="n">dd</span><span class="p">],</span><span class="n">poly_index_jj</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">pii</span><span class="o">&lt;</span><span class="n">pjj</span><span class="p">:</span>
                <span class="n">tmp</span><span class="o">=</span><span class="n">pjj</span><span class="p">;</span> <span class="n">pjj</span><span class="o">=</span><span class="n">pii</span><span class="p">;</span> <span class="n">pii</span><span class="o">=</span><span class="n">tmp</span>
            <span class="n">kk</span> <span class="o">=</span> <span class="n">flattened_rectangular_lower_triangular_matrix_index</span><span class="p">(</span>
                <span class="n">pii</span><span class="p">,</span><span class="n">pjj</span><span class="p">,</span><span class="n">max_degrees1</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">max_degrees2</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">coefs_1d</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product_coefs_1d</span><span class="p">[</span><span class="n">dd</span><span class="p">][</span><span class="n">kk</span><span class="p">][:,</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">indices_1d</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">poly_index</span><span class="p">[</span><span class="n">dd</span><span class="p">]</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> 
                      <span class="k">for</span> <span class="n">dd</span> <span class="ow">in</span> <span class="n">active_vars</span><span class="p">]</span>
        <span class="n">product_coefs</span> <span class="o">=</span> <span class="n">outer_product</span><span class="p">(</span><span class="n">coefs_1d</span><span class="p">)[:,</span><span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
        <span class="n">active_product_indices</span> <span class="o">=</span> <span class="n">cartesian_product</span><span class="p">(</span><span class="n">indices_1d</span><span class="p">)</span>
        <span class="n">II</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">absolute</span><span class="p">(</span><span class="n">product_coefs</span><span class="p">)</span><span class="o">&gt;</span><span class="n">tol</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">active_product_indices</span> <span class="o">=</span> <span class="n">active_product_indices</span><span class="p">[:,</span><span class="n">II</span><span class="p">]</span>
        <span class="n">product_coefs</span> <span class="o">=</span> <span class="n">product_coefs</span><span class="p">[</span><span class="n">II</span><span class="p">]</span>
        <span class="n">product_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="n">num_vars</span><span class="p">,</span><span class="n">active_product_indices</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">product_indices</span><span class="p">[</span><span class="n">active_vars</span><span class="p">]</span><span class="o">=</span><span class="n">active_product_indices</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">product_coefs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">product_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">num_vars</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">product_indices</span><span class="p">,</span> <span class="n">product_coefs</span></div>

<div class="viewcode-block" id="multiply_multivariate_orthonormal_polynomial_expansions"><a class="viewcode-back" href="../../api/pyapprox.multivariate_polynomials.multiply_multivariate_orthonormal_polynomial_expansions.html#pyapprox.multivariate_polynomials.multiply_multivariate_orthonormal_polynomial_expansions">[docs]</a><span class="k">def</span> <span class="nf">multiply_multivariate_orthonormal_polynomial_expansions</span><span class="p">(</span><span class="n">product_coefs_1d</span><span class="p">,</span><span class="n">poly_indices1</span><span class="p">,</span><span class="n">poly_coefficients1</span><span class="p">,</span><span class="n">poly_indices2</span><span class="p">,</span><span class="n">poly_coefficients2</span><span class="p">):</span>    
    <span class="n">num_indices1</span> <span class="o">=</span> <span class="n">poly_indices1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">num_indices2</span> <span class="o">=</span> <span class="n">poly_indices2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">assert</span> <span class="n">num_indices2</span><span class="o">&lt;=</span><span class="n">num_indices1</span>
    <span class="k">assert</span> <span class="n">poly_coefficients1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">num_indices1</span>
    <span class="k">assert</span> <span class="n">poly_coefficients2</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">num_indices2</span>
    
    <span class="n">num_vars</span> <span class="o">=</span> <span class="n">poly_indices1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">num_qoi</span> <span class="o">=</span> <span class="n">poly_coefficients1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1">#following assumes the max degrees were used to create product_coefs_1d</span>
    <span class="n">max_degrees1</span> <span class="o">=</span> <span class="n">poly_indices1</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">max_degrees2</span> <span class="o">=</span> <span class="n">poly_indices2</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">basis_coefs</span><span class="p">,</span><span class="n">basis_indices</span> <span class="o">=</span> <span class="p">[],[]</span>
    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_indices1</span><span class="p">):</span>
        <span class="n">poly_index_ii</span> <span class="o">=</span> <span class="n">poly_indices1</span><span class="p">[:,</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">active_vars_ii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">poly_index_ii</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_indices2</span><span class="p">):</span>
            <span class="n">poly_index_jj</span> <span class="o">=</span> <span class="n">poly_indices2</span><span class="p">[:,</span><span class="n">jj</span><span class="p">]</span>
            <span class="n">product_indices</span><span class="p">,</span> <span class="n">product_coefs</span> <span class="o">=</span> \
                <span class="n">compute_multivariate_orthonormal_basis_product</span><span class="p">(</span>
                    <span class="n">product_coefs_1d</span><span class="p">,</span><span class="n">poly_index_ii</span><span class="p">,</span><span class="n">poly_index_jj</span><span class="p">,</span>
                    <span class="n">max_degrees1</span><span class="p">,</span><span class="n">max_degrees2</span><span class="p">)</span>
            <span class="c1">#print(ii,jj,product_coefs,poly_index_ii,poly_index_jj)</span>
            <span class="c1">#TODO for unique polynomials the product_coefs and indices</span>
            <span class="c1"># of [0,1,2] is the same as [2,1,0] so perhaps store</span>
            <span class="c1"># sorted active indices and look up to reuse computations</span>
            <span class="n">product_coefs_iijj</span> <span class="o">=</span> <span class="n">product_coefs</span><span class="o">*</span><span class="n">poly_coefficients1</span><span class="p">[</span><span class="n">ii</span><span class="p">,:]</span><span class="o">*</span>\
                <span class="n">poly_coefficients2</span><span class="p">[</span><span class="n">jj</span><span class="p">,:]</span>
            <span class="n">basis_coefs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product_coefs_iijj</span><span class="p">)</span>
            <span class="n">basis_indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">product_indices</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">basis_coefs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="n">basis_indices</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">indices</span><span class="p">,</span> <span class="n">coefs</span> <span class="o">=</span> <span class="n">add_polynomials</span><span class="p">(</span><span class="n">basis_indices</span><span class="p">,</span><span class="n">basis_coefs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">indices</span><span class="p">,</span> <span class="n">coefs</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019 National Technology &amp; Engineering Solutions of Sandia, LLC (NTESS). Under the terms of Contract DE-NA0003525 with NTESS, the U.S. Government retains certain rights in this software.

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>